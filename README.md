# 在线拍卖系统 (Online Auction System)

基于 Flask + Socket.IO + MySQL 构建的实时在线拍卖平台。支持实时竞价、即时通讯、订单支付模拟及完善的后台管理功能。

## ✨ 主要功能

*   **实时竞价**：基于 WebSocket 的毫秒级报价同步，支持防狙击机制（最后3分钟出价自动延时）及防连续出价。
*   **用户角色**：
    *   **管理员**：拥有独立的后台管理看板（支持分标签页管理：待审核、进行中、申诉处理、历史记录），可处理商品申诉、管理用户。
    *   **卖家**：发布拍品（支持 Decimal 高精度定价、商品分类选择）、管理草稿、查看销售记录、处理物流、对被驳回商品发起申诉。
    *   **买家**：浏览搜索（支持按分类筛选、按价格/时间排序）、参与竞拍、收藏商品、中标支付、即时通讯。
*   **钱包与资金系统**：
    *   **余额充值**：支持模拟微信/支付宝扫码充值（生成二维码）。
    *   **保证金机制**：竞拍成功后资金暂时冻结，确认收货后解冻并划转给卖家。
    *   **流水记录**：完整的资金变动明细（充值、支付、退款、违约扣除）。
*   **申诉系统**：卖家可针对被驳回的商品提交申诉理由，管理员可在后台“申诉处理”栏目中进行二次审核。
*   **即时通讯**：买卖双方可进行私信沟通，支持未读消息红点提醒。
*   **交互体验**：
    *   **商品收藏**：用户可关注感兴趣的商品，在“我的收藏”中快速查看。
    *   **高级筛选**：首页支持按商品分类筛选、按价格高低或剩余时间排序。
    *   **自动刷新**：筛选条件改变时自动提交搜索。
*   **支付与物流**：
    *   中标后生成模拟支付二维码。
    *   支付超时自动惩罚机制（24小时未付封禁30天）。
    *   发货地址录入与同步。
*   **通知系统**：全站实时 Toast 通知（中标/流拍/新消息/审核结果）。

## 🛠️ 环境准备

1.  **Python 3.8+**
2.  **MySQL 8.0+**
3.  **浏览器**：推荐 Chrome/Edge (支持现代 WebSocket)

## 🚀 安装部署指南

### 1. 数据库配置
在 MySQL 中创建一个空的数据库，命名为 `Auction`：
```sql
CREATE DATABASE Auction DEFAULT CHARACTER SET utf8mb4;
```
*注：系统启动时会自动创建所需的数据表结构（包含用户、商品、钱包、收藏等表）。*

### 2. 项目配置
打开 `app.py`，确认数据库连接配置（根据你的实际 MySQL 账号密码修改）：
```python
# app.py
app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:123456@localhost/Auction'
```

### 3. 环境安装
```bash
# 创建虚拟环境 (可选但推荐)
python -m venv venv
# 激活环境 (Windows)
.\venv\Scripts\activate

# 安装依赖项 (包含 Flask, Flask-SocketIO, PyMySQL, qrcode 等)
pip install -r requirements.txt
pip install qrcode[pil]
```

### 4. 启动系统
```bash
python app.py
```
终端显示 `Running on http://0.0.0.0:5000` 即表示启动成功。

*首次启动时，系统会自动创建一个默认管理员账号：*
*   用户名：`admin`
*   密码：`123`

## 📖 使用手册

### 访问
打开浏览器访问：`http://127.0.0.1:5000`

### 典型测试流程
1.  **注册充值**：
    *   注册买家账号，进入“我的钱包”页面。
    *   点击“充值”，输入金额，扫描模拟二维码完成充值。
2.  **卖家发布**：
    *   登录卖家账号，点击“发布拍卖”。
    *   填写商品信息，选择正确的**分类**（如“艺术品”、“数码产品”）。
3.  **管理员审核**：
    *   登录 `admin`，进入后台管理页面（Dashboard），在 **Audit** 标签页通过审核。
4.  **买家竞拍与收藏**：
    *   买家在首页使用**筛选**（Category）和**排序**（Sort By）找到商品。
    *   点击心形图标**收藏**商品。
    *   进入详情页出价（需确保钱包余额充足）。
5.  **成交流程与资金划转**：
    *   竞拍结束（时间到），中标者点击“立即支付”。
    *   资金从“可用余额”转入“冻结金额”。
    *   卖家发货，买家点击“确认收货”。
    *   系统解冻资金并划转至卖家钱包。

## 🌐 局域网访问 (手机/其他电脑)

1.  **获取本机 IP**：终端运行 `ipconfig`，找到 IPv4 地址（如 `192.168.1.5`）。
2.  **防火墙设置**：确保 Windows 防火墙允许 Python 程序通过公共/专用网络。
3.  **访问**：在同一 Wi-Fi 下的设备浏览器输入 `http://192.168.1.5:5000`。

## ⚠️ 注意事项
*   本系统支付功能仅为逻辑模拟，生成的二维码不产生实际扣款。
*   实名认证信息仅用于演示，不进行真实 API 校验。
